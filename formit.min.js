let d=document;d.c=d.createElement;let s='span';let p=HTMLElement.prototype;p.s=p.setAttribute;p.a=p.appendChild;
function form(formId, obj, preventDefault = true) {
    const callbacks = {}
    const f = d.createElement('form')
    f.id = formId

    function change() {
        let arg = obj
        f.querySelectorAll('input').forEach(e => {
            switch (e.type) {
                case "text":
                    arg[e.attributes.formvalue] = e.value
                    break
                case "checkbox":
                    arg[e.attributes.formvalue] = e.checked
                    break
                case "range":
                    arg[e.attributes.formvalue] = parseInt(e.value)
                    break
                case "number":
                    arg[e.attributes.formvalue] = parseFloat(e.value)
                    break
                case "radio":
                    if (e.checked) {
                        arg[e.attributes.formvalue] = e.value
                    }
            }
        })
        callbacks[formId](arg)
    }

    function callback(fn) {
        callbacks[formId] = fn
        return f
    }

    let numRadioInputs = 0

    Object.entries(obj).forEach(([k, v]) => {
        let container = d.c(s)
        let c = d.c('input')
        switch (typeof v) {
            case "string":
                c.s("type", "text")
                c.s("placeholder", v)
                break
            case "number":
                c.s("type", "number")
                break
            case "boolean":
                c.s("type", "checkbox")
                c.checked = v
                break
            case "object":
                switch (v.type) {
                    case "number":
                    case "range":
                        Object.entries(v).forEach(entry => c.s(entry[0], entry[1]))
                        break
                    case "radio":
                        c = d.c(s)
                        c.type = "radio-container"

                        v.options.forEach((option, i) => {
                            let b = d.c("input")
                            if (i == 0) {
                                b.checked = "checked"
                            }
                            let u = d.c(s)
                            let t = d.c(s)
                            t.classList.add("container")
                            let p = d.c(s)
                            p.classList.add("checkmark")
                            let label = d.c('label')
                            label.s("for", option)
                            label.textContent = option

                            b.type = "radio"
                            b.name = `${formId}-${numRadioInputs}`
                            b.id = `${b.name}-${option}`
                            b.value = option
                            b.attributes.formvalue = k

                            u.a(label)
                            t.a(b)
                            t.a(p)
                            u.a(t)
                            c.a(u)
                        })
                        numRadioInputs++
                        break
                }

                break
        }
        c.attributes.formvalue = k
        c.oninput = change
        const label = d.c('label')
        label.s("for", k)
        label.textContent = k
        container.a(label)
        container.a(c)
        f.a(container)
    })
    return {
        onChange: callback
    }
}

function slider(min, max, val = min / max) {
    return {
        type: "range",
        min: min,
        max: max,
        value: val,
    }
}

function number(min, max, val = min / max) {
    return {
        type: "number",
        min: min,
        max: max,
        value: val,
    }
}

function radio(options) {
    const ret = { options: [] }
    options.forEach(option => {
        ret.options.push(option)
    })
    ret["type"] = "radio"
    return ret
}

addEventListener('DOMContentLoaded', () => {
    d.querySelector('body').appendChild(
        form("formit", {
            one: 1,
            two: "Test",
            three: false,
            four: slider(0, 10),
            five: radio(["one", "two", "three"], true)
        }).onChange((data) => console.log(data))
    )
    d.querySelector('body').appendChild(
        form("formit", {
            one: 1,
        }).onChange((data) => console.log(data))
    )
});